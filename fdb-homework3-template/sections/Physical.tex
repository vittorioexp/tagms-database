\section{Physical Schema}
\textcolor{red}{[Report SQL statements for the database creation]}

-- Database Creation
\begin{lstlisting}[
stringstyle=\color{grey},
basicstyle=\ttfamily\footnotesize]

-- Database Creation
CREATE DATABASE tagmsdb OWNER admin ENCODING = `UTF8';

-- Create new Schema (you can use the public schema without creating a new one, if you want)
DROP SCHEMA IF EXISTS Tagms CASCADE;
CREATE SCHEMA Tagms;

-- Create new domains
CREATE DOMAIN Tagms.emailaddress AS VARCHAR(254)
CONSTRAINT properemail CHECK (((VALUE)::text ~* '^[A-Za-z0-9._%]+@[A-Za-z0-9.]+[.][A-Za-z]+$'::text));
CREATE DOMAIN Tagms.vatnumber AS VARCHAR(15)
CONSTRAINT properVAT CHECK (((VALUE)::text ~* '[A-Za-z0-9]{5,}'::text));
CREATE DOMAIN Tagms.serial AS CHAR(10)
CONSTRAINT properserial CHECK (((VALUE)::text ~* '[0-9]{10}'::text));
CREATE DOMAIN Tagms.phonenumber AS VARCHAR(17)
CONSTRINT properphonenumber CHECK ( VALUE ~ ^(\((00|\+)39\)|(00|\+)39)?(38[890]|34[7-90]|36[680]|33[3-90]|32[89])\d{7}$ )
CREATE DOMAIN Tagms.price AS MONEY
CONSTRAINT price CHECK (VALUE > 0);
CREATE DOMAIN Tagms.quantity AS INTEGER
CONSTRAINT quantity CHECK (VALUE >= 1);
CREATE DOMAIN Tagms.tax AS CHAR(16)
CONSTRAINT tax CHECK (VALUE ~ ^[A-Z]{6}\d{2}[A-Z]\d{2}[A-Z]\d{3}[A-Z]$ );
CREATE DOMAIN Tagms.dimension AS INTEGER
CONSTRAINT dimension CHECK (VALUE > 0);
CREATE DOMAIN Tagms.discount AS INTEGER
CONSTRAINT dimension CHECK (VALUE > 0);

-- Table Creation (create tables in the correct order, i.e. use FKeys only referring to
already created tables)

CREATE TABLE Tagms.product (
product_id SERIAL PRIMARY KEY,
name VARCHAR(32) NOT NULL,
description VARCHAR(500),
production_cost price NOT NULL,
price_increase price NOT NULL,
volume dimension NOT NULL,
net_weight INTEGER NOT NULL,
package_weight INTEGER NOT NULL,
nutritional_facts VARCHAR(500) NOT NULL,
product_category_id INTEGER NOT NULL,
FOREIGN KEY (product_category_id) REFERENCES Tagms.product_category(product_category_id)
);

CREATE TABLE Tagms.product_category (
product_category_id SERIAL PRIMARY KEY,
name VARCHAR(32) NOT NULL,
description VARCHAR(500)
);

CREATE TABLE Tagms.item (
item_id SERIAL PRIMARY KEY,
name VARCHAR(32) NOT NULL,
description VARCHAR(500),
quantity quantity NOT NULL,
minimum_quantity quantity NOT NULL,
item_category_id INTEGER NOT NULL,
FOREIGN KEY (item_category_id) REFERENCES Tagms.item_category(item_category_id)
);

CREATE TABLE Tagms.item_category (
item_category_id SERIAL PRIMARY KEY,
name VARCHAR(32) NOT NULL,
description VARCHAR(500)
);

CREATE TABLE Tagms.specify (
item_id SERIAL,
contract_id SERIAL,
price price NOT NULL,
purchased_quantity quantity NOT NULL,
FOREIGN KEY (item_id) REFERENCES Tagms.item(item_id),
FOREIGN KEY (contract_id) REFERENCES Tagms.contract(contract_id),
PRIMARY KEY (item_id, contract_id)
);

CREATE TABLE Tagms.contract (
contract_id SERIAL PRIMARY KEY,
description VARCHAR(500),
contract_date TIMESTAMP WITH TIME ZONE NOT NULL,
delivery_date TIMESTAMP WITH TIME ZONE NOT NULL,
expiration_date TIMESTAMP WITH TIME ZONE NOT NULL,
supplier_id vatnumber NOT NULL,
employee_id tax NOT NULL,
FOREIGN KEY (supplier_id) REFERENCES Tagms.supplier(vat_number),
FOREIGN KEY (employee_id) REFERENCES Tagms.employee(tax_number)
);

CREATE TABLE Tagms.package (
package_id SERIAL PRIMARY KEY,
name VARCHAR(32) NOT NULL,
description VARCHAR(500),
weight dimension NOT NULL,
height dimension NOT NULL,
width dimension NOT NULL,
depth dimension NOT NULL,
package_category_id INTEGER NOT NULL,
FOREIGN KEY (package_category_id) REFERENCES Tagms.package_category(package_category_id)
);

CREATE TABLE Tagms.package_category (
package_category_id SERIAL PRIMARY KEY,
name VARCHAR(32) NOT NULL,
description VARCHAR(500)
);

%TODO: Create discount domain. Fix vat
CREATE TABLE Tagms.lot (
lot_id SERIAL PRIMARY KEY,
expiration_date TIMESTAMP WITH TIME ZONE NOT NULL,
product_quantity quantity NOT NULL,
package_quantity quantity NOT NULL,
lot_discount  NOT NULL,
vat  NOT NULL,
lot_price price NOT NULL,
package_id SERIAL NOT NULL,
product_id SERIAL NOT NULL,
FOREIGN KEY (package_id) REFERENCES Tagms.package(package_id),
FOREIGN KEY (product_id) REFERENCES Tagms.product(product_id)
);

%TODO: Fix taxes
CREATE TABLE Tagms.order (
order_id SERIAL PRIMARY KEY,
net_price price NOT NULL,
taxes NOT NULL,
order_date TIMESTAMP WITH TIME ZONE NOT NULL,
employee_id tax NOT NULL,
customer_id vatnumber NOT NULL,
FOREIGN KEY (employee_id) REFERENCES Tagms.employee(employee_id),
FOREIGN KEY (customer_id) REFERENCES Tagms.customer(customer_id)
);

%Fixed registration_date_id in registration_date
CREATE TABLE Tagms.customer (
vat_number vatnumber PRIMARY KEY,
customer_name VARCHAR(20) NOT NULL,
phone_number phonenumber NOT NULL,
address VARCHAR(30) NOT NULL,
email_address emailaddress NOT NULL,
registration_date TIMESTAMP WITH TIME ZONE NOT NULL
);
%TODO: Fix the keys
CREATE TABLE Tagms.draws_from (
lot_id SERIAL NOT NULL,
order_id SERIAL
);

CREATE TABLE Tagms.made_up_of_1 (
product_id INTEGER,
item_id INTEGER,
quantity quantity NOT NULL,
FOREIGN KEY (product_id) REFERENCES Tagms.product(product_id),
FOREIGN KEY (item_id) REFERENCES Tagms.item(item_id),
PRIMARY KEY (product_id, item_id)
);

CREATE TABLE Tagms.made_up_of_2 (
package_id INTEGER,
item_id INTEGER,
quantity quantity NOT NULL,
FOREIGN KEY (package_id) REFERENCES Tagms.package(package_id),
FOREIGN KEY (item_id) REFERENCES Tagms.item(item_id),
PRIMARY KEY (package_id, item_id)
);

CREATE TABLE Tagms.ship (
order_id TINYINT SERIAL PRIMARY KEY,
employee_id VARCHAR(30) NOT NULL,
shipping_date VARCHAR(256)
track_num
);

CREATE TABLE Tagms.role (
role_id TINYINT SERIAL PRIMARY KEY,
name VARCHAR(30) NOT NULL,
description VARCHAR(256)
);

CREATE TABLE Tagms.employee (
tax_number VARCHAR(17) PRIMARY KEY,
first_name VARCHAR(20),
last_name VARCHAR(20),
phone_number phonenumber,
email_address emailaddress,
birth_date DATE,
hiring_date DATE,
still_working BOOL,
role_id TINYINT,
FOREIGN KEY (role_id) REFERENCES Tagms.role(role_id)
);


\end{lstlisting}